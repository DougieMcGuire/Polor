<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polor - Join A Game</title>
    <style>
        @font-face {
            font-family: 'MainFont';
            src: url('https://polor.org/assets/MainFont.ttf') format('truetype');
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: #ff6b6b;
            height: 100vh;
            overflow: hidden;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            position: relative;
        }

        /* Animated background lines */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(45deg, rgba(255, 255, 255, 0.1) 1px, transparent 1px),
                linear-gradient(-45deg, rgba(255, 255, 255, 0.1) 1px, transparent 1px);
            background-size: 40px 40px, 60px 60px;
            animation: moveLines 20s linear infinite;
            z-index: 1;
        }

        @keyframes moveLines {
            0% { transform: translate(0, 0); }
            100% { transform: translate(40px, 40px); }
        }

        .background-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.1);
            z-index: 2;
        }

        .header {
            position: relative;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background: #ff6b6b;
            border-bottom: 5px solid #333;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .polor-logo {
            position: absolute;
            left: 20px;
            height: 50px;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .polor-logo:hover {
            transform: scale(1.1);
        }

        .header-text {
            font-family: 'MainFont', 'Comic Sans MS', cursive, sans-serif;
            font-size: 48px;
            font-weight: bold;
            color: white;
            text-shadow: 
                -3px -3px 0 #333,
                3px -3px 0 #333,
                -3px 3px 0 #333,
                3px 3px 0 #333,
                0 0 10px rgba(0, 0, 0, 0.5);
            margin: 0;
        }

        .main-container {
            position: relative;
            z-index: 5;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: calc(100vh - 120px);
            gap: 30px;
        }

        .avatar-container {
            position: relative;
            width: 150px;
            height: 150px;
        }

        .avatar-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            border: 5px solid #333;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
            transition: transform 0.2s ease;
        }

        .avatar-circle:hover {
            transform: scale(1.05);
        }

        .avatar-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .edit-button {
            position: absolute;
            bottom: 10px;
            right: 10px;
            width: 40px;
            height: 40px;
            background: #ff6b6b;
            border: 3px solid #333;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        .edit-button:hover {
            background: #ff5252;
            transform: scale(1.1);
        }

        .edit-icon {
            width: 20px;
            height: 20px;
            filter: brightness(0) invert(1);
        }

        .code-input-container {
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 20px;
            border: 4px solid #333;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }

        .code-input {
            width: 300px;
            height: 50px;
            font-family: 'MainFont', 'Comic Sans MS', cursive, sans-serif;
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            border: 3px solid #333;
            border-radius: 15px;
            padding: 10px;
            outline: none;
            transition: all 0.2s ease;
        }

        .code-input::placeholder {
            font-family: 'MainFont', 'Comic Sans MS', cursive, sans-serif;
        }

        .code-input:focus {
            border-color: #ff6b6b;
            box-shadow: 0 0 10px rgba(255, 107, 107, 0.5);
        }

        .submit-button {
            width: 50px;
            height: 50px;
            background: #ff6b6b;
            border: 3px solid #333;
            border-radius: 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .submit-button:hover {
            background: #ff5252;
            transform: scale(1.1);
        }

        .checkmark {
            width: 25px;
            height: 25px;
            filter: brightness(0) invert(1);
        }

        /* Avatar Editor Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            width: 600px;
            height: 700px;
            background: white;
            border: 5px solid #333;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
        }

        .modal-top {
            height: 50%;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            border-bottom: 3px solid #333;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
        }

        .close-button {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 35px;
            height: 35px;
            background: #ff6b6b;
            border: 3px solid #333;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            color: white;
            transition: all 0.2s ease;
        }

        .close-button:hover {
            background: #ff5252;
            transform: scale(1.1);
        }

        .avatar-preview {
            width: 200px;
            height: 200px;
            border: 4px solid #333;
            border-radius: 20px;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            margin-bottom: 20px;
            position: relative;
        }

        .save-button {
            background: #ff6b6b;
            border: 3px solid #333;
            padding: 12px 30px;
            border-radius: 15px;
            font-size: 18px;
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: 'MainFont', 'Comic Sans MS', cursive, sans-serif;
        }

        .save-button:hover {
            background: #ff5252;
            transform: scale(1.05);
        }

        .modal-bottom {
            height: 50%;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .category-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .category-tab {
            padding: 8px 16px;
            background: #e9ecef;
            border: 2px solid #333;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s ease;
            font-size: 14px;
        }

        .category-tab.active {
            background: #ff6b6b;
            color: white;
        }

        .category-tab:hover {
            transform: scale(1.05);
        }

        .item-selector {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            height: 100px;
        }

        .nav-arrow {
            width: 40px;
            height: 40px;
            background: #ff6b6b;
            border: 3px solid #333;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            color: white;
            transition: all 0.2s ease;
        }

        .nav-arrow:hover {
            background: #ff5252;
            transform: scale(1.1);
        }

        .nav-arrow.disabled {
            background: #ccc;
            cursor: not-allowed;
            opacity: 0.5;
        }

        .current-item {
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 200px;
            height: 80px;
            padding: 10px;
            background: rgba(255, 107, 107, 0.1);
            border: 2px solid #ff6b6b;
            border-radius: 10px;
        }

        .current-item-image {
            max-width: 60px;
            max-height: 60px;
            object-fit: contain;
        }

        .loading {
            color: #666;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="background-overlay"></div>
    
    <div class="header">
        <img src="assets/polortext.png" alt="Polor Logo" class="polor-logo" onclick="window.open('https://polor.org', '_blank')">
        <h1 class="header-text">Join A Game</h1>
    </div>

    <div class="main-container">
        <div class="avatar-container">
            <div class="avatar-circle" id="avatarCircle">
                <canvas id="avatarCanvas" width="140" height="140" class="avatar-image"></canvas>
            </div>
            <div class="edit-button" onclick="openAvatarEditor()">
                <svg class="edit-icon" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                </svg>
            </div>
        </div>

        <div class="code-input-container">
            <input type="text" class="code-input" id="codeInput" placeholder="Enter Game Code" maxlength="6">
            <div class="submit-button" onclick="joinGame()">
                <svg class="checkmark" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                </svg>
            </div>
        </div>
    </div>

    <!-- Avatar Editor Modal -->
    <div class="modal-overlay" id="avatarModal">
        <div class="modal-content">
            <div class="modal-top">
                <div class="close-button" onclick="closeAvatarEditor()">×</div>
                <div class="avatar-preview">
                    <canvas id="previewCanvas" width="190" height="190"></canvas>
                </div>
                <button class="save-button" onclick="saveAvatar()">Save Avatar</button>
            </div>
            <div class="modal-bottom">
                <div class="category-tabs" id="categoryTabs"></div>
                <div class="item-selector">
                    <div class="nav-arrow" id="prevArrow" onclick="previousItem()">‹</div>
                    <div class="current-item" id="currentItem">
                        <span class="loading">Loading...</span>
                    </div>
                    <div class="nav-arrow" id="nextArrow" onclick="nextItem()">›</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Avatar data - will be loaded from manifest
        let avatarData = {};
        let manifestLoaded = false;

        // Current avatar configuration
        let currentAvatar = {
            bases: 'bases/7.png',
            hair: null,
            eyes: 'eyes/BasicMale.png',
            mouth: 'mouth/Basic.png',
            nose: 'nose/basic.png',
            tops: 'tops/1.png',
            brows: null,
            glasses: null,
            hats: null,
            neck: null,
            ears: null,
            extra: null,
            face: null
        };

        // Editor state
        let currentCategory = 'bases';
        let categoryIndices = {}; // Remember index for each category

        // Load manifest from polor.org
        async function loadManifest() {
            try {
                console.log('Loading manifest...');
                const response = await fetch('https://polor.org/Avatars/manifest.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                avatarData = await response.json();
                manifestLoaded = true;
                console.log('Manifest loaded:', avatarData);
                
                // Initialize category indices
                Object.keys(avatarData).forEach(category => {
                    if (avatarData[category] && avatarData[category].length > 0) {
                        // Set default indices based on current avatar
                        if (category === 'bases' && currentAvatar.bases) {
                            const filename = currentAvatar.bases.split('/')[1];
                            const index = avatarData[category].indexOf(filename);
                            categoryIndices[category] = index >= 0 ? index : 0;
                        } else if (category === 'tops' && currentAvatar.tops) {
                            const filename = currentAvatar.tops.split('/')[1];
                            const index = avatarData[category].indexOf(filename);
                            categoryIndices[category] = index >= 0 ? index : 0;
                        } else if (category === 'eyes' && currentAvatar.eyes) {
                            const filename = currentAvatar.eyes.split('/')[1];
                            const index = avatarData[category].indexOf(filename);
                            categoryIndices[category] = index >= 0 ? index : 0;
                        } else if (category === 'nose' && currentAvatar.nose) {
                            const filename = currentAvatar.nose.split('/')[1];
                            const index = avatarData[category].indexOf(filename);
                            categoryIndices[category] = index >= 0 ? index : 0;
                        } else if (category === 'mouth' && currentAvatar.mouth) {
                            const filename = currentAvatar.mouth.split('/')[1];
                            const index = avatarData[category].indexOf(filename);
                            categoryIndices[category] = index >= 0 ? index : 0;
                        } else {
                            // For categories with "None" option, start at 0 (None)
                            categoryIndices[category] = 0;
                        }
                    }
                });
                
            } catch (error) {
                console.error('Failed to load manifest:', error);
                manifestLoaded = false;
                // Use fallback minimal structure
                avatarData = {
                    bases: ['1.png', '2.png', '3.png', '7.png'],
                    hair: ['1.png', '2.png', '3.png'],
                    eyes: ['BasicMale.png', 'BasicFemale.png'],
                    mouth: ['Basic.png'],
                    nose: ['basic.png'],
                    tops: ['1.png', '2.png', '3.png'],
                    brows: [],
                    glasses: [],
                    hats: [],
                    neck: [],
                    ears: [],
                    extra: [],
                    face: []
                };
                // Initialize fallback indices
                Object.keys(avatarData).forEach(category => {
                    categoryIndices[category] = 0;
                });
            }
        }

        // Load saved avatar from localStorage
        function loadSavedAvatar() {
            const savedAvatar = localStorage.getItem('avatar');
            if (savedAvatar) {
                console.log('Loading saved avatar:', savedAvatar);
                const avatarImg = new Image();
                avatarImg.crossOrigin = 'anonymous';
                avatarImg.onload = function() {
                    const canvas = document.getElementById('avatarCanvas');
                    const ctx = canvas.getContext('2d');
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.drawImage(avatarImg, 0, 0, canvas.width, canvas.height);
                };
                avatarImg.onerror = function() {
                    console.log('Failed to load saved avatar, using default');
                    renderAvatar();
                };
                avatarImg.src = `https://i.ibb.co/${savedAvatar}.png`;
            } else {
                renderAvatar();
            }
        }

        // Render avatar on canvas (optimized to reduce flashing)
        function renderAvatar() {
            const canvas = document.getElementById('avatarCanvas');
            const ctx = canvas.getContext('2d');
            
            // Create offscreen canvas for smoother rendering
            const offscreenCanvas = document.createElement('canvas');
            offscreenCanvas.width = canvas.width;
            offscreenCanvas.height = canvas.height;
            const offscreenCtx = offscreenCanvas.getContext('2d');

            const renderOrder = ['bases', 'tops', 'hair', 'eyes', 'nose', 'mouth', 'brows', 'neck', 'glasses', 'hats', 'ears', 'extra', 'face'];
            let imagesLoaded = 0;
            const totalImages = renderOrder.filter(cat => currentAvatar[cat]).length;

            if (totalImages === 0) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                return;
            }

            function checkComplete() {
                imagesLoaded++;
                if (imagesLoaded === totalImages) {
                    // Only update visible canvas when all images are loaded
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.drawImage(offscreenCanvas, 0, 0);
                }
            }

            renderOrder.forEach(category => {
                if (currentAvatar[category]) {
                    const img = new Image();
                    img.crossOrigin = 'anonymous';
                    img.onload = function() {
                        offscreenCtx.drawImage(img, 0, 0, offscreenCanvas.width, offscreenCanvas.height);
                        checkComplete();
                    };
                    img.onerror = function() {
                        console.warn(`Failed to load ${category} image:`, currentAvatar[category]);
                        checkComplete();
                    };
                    img.src = `https://polor.org/Avatars/characters/${currentAvatar[category]}`;
                }
            });
        }

        // Render preview avatar in editor (optimized)
        function renderPreviewAvatar() {
            const canvas = document.getElementById('previewCanvas');
            const ctx = canvas.getContext('2d');
            
            // Create offscreen canvas for smoother rendering
            const offscreenCanvas = document.createElement('canvas');
            offscreenCanvas.width = canvas.width;
            offscreenCanvas.height = canvas.height;
            const offscreenCtx = offscreenCanvas.getContext('2d');

            const renderOrder = ['bases', 'tops', 'hair', 'eyes', 'nose', 'mouth', 'brows', 'neck', 'glasses', 'hats', 'ears', 'extra', 'face'];
            let imagesLoaded = 0;
            const totalImages = renderOrder.filter(cat => currentAvatar[cat]).length;

            if (totalImages === 0) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                return;
            }

            function checkComplete() {
                imagesLoaded++;
                if (imagesLoaded === totalImages) {
                    // Only update visible canvas when all images are loaded
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.drawImage(offscreenCanvas, 0, 0);
                }
            }

            renderOrder.forEach(category => {
                if (currentAvatar[category]) {
                    const img = new Image();
                    img.crossOrigin = 'anonymous';
                    img.onload = function() {
                        offscreenCtx.drawImage(img, 0, 0, offscreenCanvas.width, offscreenCanvas.height);
                        checkComplete();
                    };
                    img.onerror = function() {
                        checkComplete();
                    };
                    img.src = `https://polor.org/Avatars/characters/${currentAvatar[category]}`;
                }
            });
        }

        // Open avatar editor
        async function openAvatarEditor() {
            if (!manifestLoaded) {
                await loadManifest();
            }
            document.getElementById('avatarModal').style.display = 'flex';
            initializeEditor();
            renderPreviewAvatar();
        }

        // Close avatar editor
        function closeAvatarEditor() {
            document.getElementById('avatarModal').style.display = 'none';
        }

        // Initialize editor interface
        function initializeEditor() {
            const tabsContainer = document.getElementById('categoryTabs');
            tabsContainer.innerHTML = '';
            
            // Only show categories that have items
            Object.keys(avatarData).forEach(category => {
                if (avatarData[category] && avatarData[category].length > 0) {
                    const tab = document.createElement('div');
                    tab.className = `category-tab ${category === currentCategory ? 'active' : ''}`;
                    tab.textContent = category.charAt(0).toUpperCase() + category.slice(1);
                    tab.onclick = () => selectCategory(category);
                    tabsContainer.appendChild(tab);
                }
            });
            
            // Reset to valid category if current one is empty
            if (!avatarData[currentCategory] || avatarData[currentCategory].length === 0) {
                currentCategory = Object.keys(avatarData).find(cat => avatarData[cat] && avatarData[cat].length > 0) || 'bases';
            }
            
            updateCurrentItem();
        }

        // Select category
        function selectCategory(category) {
            currentCategory = category;
            
            // Update active tab
            document.querySelectorAll('.category-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            updateCurrentItem();
        }

        // Update current item display
        function updateCurrentItem() {
            const items = avatarData[currentCategory];
            if (!items || items.length === 0) {
                document.getElementById('currentItem').innerHTML = '<span class="loading">No items</span>';
                return;
            }
            
            // Get current index for this category
            const currentIndex = categoryIndices[currentCategory] || 0;
            const currentItemElement = document.getElementById('currentItem');
            currentItemElement.innerHTML = '';
            
            // Categories that should have "None" option
            const noneCategories = ['neck', 'hats', 'glasses', 'hair'];
            const hasNoneOption = noneCategories.includes(currentCategory);
            
            if (currentIndex === 0 && hasNoneOption) {
                // Show "None" option
                const noneDiv = document.createElement('div');
                noneDiv.textContent = 'None';
                noneDiv.style.fontWeight = 'bold';
                noneDiv.style.color = '#666';
                currentItemElement.appendChild(noneDiv);
                
                // Set avatar to null for this category
                currentAvatar[currentCategory] = null;
            } else {
                // Show actual item
                const itemIndex = hasNoneOption ? currentIndex - 1 : currentIndex;
                if (items[itemIndex]) {
                    const img = document.createElement('img');
                    img.className = 'current-item-image';
                    img.src = `https://polor.org/Avatars/characters/${currentCategory}/${items[itemIndex]}`;
                    img.onerror = function() {
                        currentItemElement.innerHTML = '<span class="loading">Failed to load</span>';
                    };
                    currentItemElement.appendChild(img);
                    
                    // Update avatar
                    currentAvatar[currentCategory] = `${currentCategory}/${items[itemIndex]}`;
                } else {
                    currentItemElement.innerHTML = '<span class="loading">None</span>';
                    currentAvatar[currentCategory] = null;
                }
            }
            
            // Update navigation arrows
            const prevArrow = document.getElementById('prevArrow');
            const nextArrow = document.getElementById('nextArrow');
            
            const maxIndex = hasNoneOption ? items.length : items.length - 1;
            
            prevArrow.classList.toggle('disabled', currentIndex === 0);
            nextArrow.classList.toggle('disabled', currentIndex >= maxIndex);
            
            renderPreviewAvatar();
        }

        // Navigation functions
        function previousItem() {
            const currentIndex = categoryIndices[currentCategory] || 0;
            if (currentIndex > 0) {
                categoryIndices[currentCategory] = currentIndex - 1;
                updateCurrentItem();
            }
        }

        function nextItem() {
            const items = avatarData[currentCategory];
            const currentIndex = categoryIndices[currentCategory] || 0;
            const noneCategories = ['neck', 'hats', 'glasses', 'hair'];
            const hasNoneOption = noneCategories.includes(currentCategory);
            const maxIndex = hasNoneOption ? items.length : items.length - 1;
            
            if (items && currentIndex < maxIndex) {
                categoryIndices[currentCategory] = currentIndex + 1;
                updateCurrentItem();
            }
        }

        // Save avatar to imgbb
        async function saveAvatar() {
            const canvas = document.getElementById('previewCanvas');
            
            try {
                // Convert canvas to blob
                const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/png'));
                
                // Get API key
                let apiKey = 'b67152898b5211b8132b6bb959510033'; // fallback
                try {
                    const keyResponse = await fetch('https://dougie.wtf/apikey');
                    if (keyResponse.ok) {
                        const keyText = await keyResponse.text();
                        if (keyText.trim()) {
                            apiKey = keyText.trim();
                        }
                    }
                } catch (e) {
                    console.log('Using fallback API key');
                }

                // Upload to imgbb
                const formData = new FormData();
                formData.append('image', blob);
                formData.append('key', apiKey);
                
                const uploadResponse = await fetch('https://api.imgbb.com/1/upload', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await uploadResponse.json();
                
                if (result.success) {
                    // Extract ID from URL
                    const urlParts = result.data.url.split('/');
                    const filename = urlParts[urlParts.length - 1].replace('.png', '');
                    const folder = urlParts[urlParts.length - 2];
                    const avatarKey = `${folder}/${filename}`;
                    
                    // Save to localStorage
                    localStorage.setItem('avatar', avatarKey);
                    console.log('Avatar saved:', avatarKey);
                    
                    // Update main display
                    renderAvatar();
                    closeAvatarEditor();
                } else {
                    alert('Failed to save avatar. Please try again.');
                }
            } catch (error) {
                console.error('Save error:', error);
                alert('Failed to save avatar. Please try again.');
            }
        }

        // Join game function
        function joinGame() {
            const code = document.getElementById('codeInput').value.trim();
            if (code) {
                window.location.href = `https://polor.org/join?=${code}`;
            } else {
                alert('Please enter a game code!');
            }
        }

        // Handle enter key
        document.getElementById('codeInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                joinGame();
            }
        });

        // Initialize everything
        window.onload = async function() {
            await loadManifest();
            loadSavedAvatar();
        };
    </script>
</body>
</html>
