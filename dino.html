<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Polor Bear Runner</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #87CEEB 0%, #64B5F6 100%);
      overflow: hidden;
      height: 100vh;
      display: flex;
      flex-direction: column;
      user-select: none;
    }

    .game-header {
      background: linear-gradient(135deg, #42A5F5 0%, #1E88E5 100%);
      color: white;
      padding: 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 1.5rem;
      font-weight: bold;
    }

    .score-info {
      display: flex;
      gap: 2rem;
      align-items: center;
    }

    .score-item {
      text-align: center;
    }

    .score-label {
      font-size: 0.8rem;
      opacity: 0.8;
      margin-bottom: 0.2rem;
    }

    .score-value {
      font-size: 1.2rem;
      font-weight: bold;
    }

    #gameCanvas {
      background: linear-gradient(to bottom, #E3F2FD 0%, #FFFFFF 100%);
      display: block;
      margin: 0 auto;
      flex: 1;
      cursor: pointer;
    }

    .game-instructions {
      text-align: center;
      padding: 2rem;
      background: rgba(255,255,255,0.95);
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      z-index: 10;
      border: 3px solid #42A5F5;
    }

    .game-instructions.hidden {
      display: none;
    }

    .polar-bear-logo {
      width: 80px;
      height: 80px;
      margin: 0 auto 1rem;
      background: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 3px solid #42A5F5;
      font-size: 2rem;
    }

    .start-btn {
      background: linear-gradient(135deg, #42A5F5, #1E88E5);
      color: white;
      border: none;
      padding: 1rem 2rem;
      border-radius: 15px;
      cursor: pointer;
      font-size: 1.1rem;
      font-weight: bold;
      margin-top: 1rem;
      transition: all 0.3s ease;
    }

    .start-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(66, 165, 245, 0.4);
    }

    .tap-to-start {
      position: absolute;
      bottom: 20%;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255,255,255,0.95);
      padding: 1.5rem 3rem;
      border-radius: 20px;
      text-align: center;
      font-size: 1.3rem;
      font-weight: bold;
      color: #1565C0;
      border: 3px solid #42A5F5;
      z-index: 5;
      animation: pulse 2s infinite;
    }

    .tap-to-start.hidden {
      display: none;
    }

    @keyframes pulse {
      0%, 100% { transform: translateX(-50%) scale(1); }
      50% { transform: translateX(-50%) scale(1.05); }
    }

    .quiz-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
      backdrop-filter: blur(5px);
    }

    .quiz-modal.hidden {
      display: none;
    }

    .quiz-card {
      background: white;
      border-radius: 20px;
      padding: 2rem;
      max-width: 700px;
      width: 90%;
      text-align: center;
      box-shadow: 0 20px 50px rgba(0,0,0,0.3);
      border: 3px solid #42A5F5;
    }

    .quiz-title {
      font-size: 1.5rem;
      color: #1565C0;
      margin-bottom: 1.5rem;
      font-weight: bold;
    }

    .question-image {
      width: 100%;
      max-width: 400px;
      height: 200px;
      object-fit: cover;
      border-radius: 15px;
      margin-bottom: 1.5rem;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    .question-text {
      font-size: 1.2rem;
      color: #333;
      margin-bottom: 2rem;
      line-height: 1.4;
    }

    .answers-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .answer-btn {
      background: #F8F9FA;
      border: 2px solid #E3F2FD;
      padding: 1rem;
      border-radius: 15px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 1rem;
    }

    .answer-btn:hover {
      background: #E3F2FD;
      border-color: #42A5F5;
      transform: translateY(-2px);
    }

    .answer-btn.correct {
      background: #4CAF50;
      color: white;
      border-color: #388E3C;
    }

    .answer-btn.incorrect {
      background: #F44336;
      color: white;
      border-color: #D32F2F;
    }

    .quiz-result {
      font-size: 1.2rem;
      font-weight: bold;
      margin: 1rem 0;
      padding: 1rem;
      border-radius: 15px;
    }

    .quiz-result.correct {
      background: #E8F5E8;
      color: #2E7D32;
      border: 2px solid #4CAF50;
    }

    .quiz-result.incorrect {
      background: #FFEBEE;
      color: #C62828;
      border: 2px solid #F44336;
    }

    .continue-btn {
      background: linear-gradient(135deg, #42A5F5, #1E88E5);
      color: white;
      border: none;
      padding: 1rem 2rem;
      border-radius: 15px;
      cursor: pointer;
      font-size: 1.1rem;
      font-weight: bold;
      transition: all 0.3s ease;
    }

    .continue-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .game-over-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 50;
    }

    .game-over-screen.hidden {
      display: none;
    }

    .game-over-card {
      background: white;
      border-radius: 20px;
      padding: 2rem;
      text-align: center;
      box-shadow: 0 20px 50px rgba(0,0,0,0.3);
      max-width: 400px;
      width: 90%;
      border: 3px solid #42A5F5;
    }

    @media (max-width: 768px) {
      .answers-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="game-header">
    <div class="brand">
      <span style="font-size: 1.8rem;">üêª‚Äç‚ùÑÔ∏è</span>
      <span>Polor Bear Runner</span>
    </div>
    <div class="score-info">
      <div class="score-item">
        <div class="score-label">Score</div>
        <div class="score-value" id="currentScore">0</div>
      </div>
      <div class="score-item">
        <div class="score-label">High Score</div>
        <div class="score-value" id="highScore">0</div>
      </div>
      <div class="score-item">
        <div class="score-label">Questions</div>
        <div class="score-value" id="questionsAnswered">0</div>
      </div>
    </div>
  </div>

  <canvas id="gameCanvas"></canvas>

  <div class="tap-to-start hidden" id="tapToStart">
    Tap to Start Running!
  </div>

  <div class="game-instructions" id="startScreen">
    <div class="polar-bear-logo">üêª‚Äç‚ùÑÔ∏è</div>
    <h2>Welcome to Polor Bear Runner!</h2>
    <p>Help the polar bear jump over icebergs and answer questions when you crash!</p>
    <p><strong>Controls:</strong> TAP anywhere to jump</p>
    <button class="start-btn" onclick="startGame()">Start Running</button>
  </div>

  <div class="quiz-modal hidden" id="quizModal">
    <div class="quiz-card">
      <div class="quiz-title">Answer Correctly to Continue!</div>
      <img id="questionImage" class="question-image" src="" alt="Question illustration" style="display: none;">
      <div class="question-text" id="questionText">Loading question...</div>
      <div class="answers-grid" id="answersGrid"></div>
      <div class="quiz-result hidden" id="quizResult"></div>
      <button class="continue-btn hidden" id="continueBtn" onclick="continueGame()" disabled>Continue Running</button>
    </div>
  </div>

  <div class="game-over-screen hidden" id="gameOverScreen">
    <div class="game-over-card">
      <div style="font-size: 2rem; color: #1565C0; margin-bottom: 1rem; font-weight: bold;">Great Run!</div>
      <div style="font-size: 1.5rem; color: #333; margin-bottom: 1.5rem;" id="finalScore">Final Score: 0</div>
      <div style="font-size: 1.2rem; color: #42A5F5; margin-bottom: 2rem; font-weight: bold;" id="highScoreDisplay">High Score: 0</div>
      <button class="start-btn" onclick="restartGame()">Run Again</button>
    </div>
  </div>

  <script>
    // Game variables
    let canvas, ctx;
    let gameRunning = false;
    let gamePaused = false;
    let gameSpeed = 3; // Start slower
    let gravity = 0.6;
    let score = 0;
    let highScore = localStorage.getItem('polorBearHighScore') || 0;
    let questionsAnswered = 0;
    let quizData = null;
    let currentQuestionIndex = 0;
    let usedQuestionIndices = [];
    let lastCorrectAnswer = false;
    let playerSprite = null;

    // Polar bear object
    let polarBear = {
      x: 80,
      y: 0,
      width: 40,
      height: 40,
      jumping: false,
      jumpForce: 0,
      grounded: false,
      animFrame: 0
    };

    let obstacles = [];
    let ground = { x: 0, y: 0, width: 0, height: 30 };
    let snowflakes = [];

    function initGame() {
      canvas = document.getElementById('gameCanvas');
      ctx = canvas.getContext('2d');
      
      // Load player sprite
      playerSprite = new Image();
      playerSprite.src = 'assets/dinogamerun1.png';
      playerSprite.onerror = () => {
        console.log('Could not load sprite, using fallback drawing');
        playerSprite = null;
      };
      
      resizeCanvas();
      window.addEventListener('resize', resizeCanvas);
      
      ground.y = canvas.height - ground.height;
      ground.width = canvas.width;
      polarBear.y = ground.y - polarBear.height;
      
      for (let i = 0; i < 30; i++) {
        snowflakes.push({
          x: Math.random() * canvas.width,
          y: Math.random() * canvas.height,
          size: Math.random() * 3 + 1,
          speed: Math.random() * 1 + 0.5
        });
      }
      
      loadQuizData();
      document.getElementById('highScore').textContent = highScore;
      
      canvas.addEventListener('click', handleCanvasClick);
      canvas.addEventListener('touchstart', handleCanvasTouch);
      document.addEventListener('keydown', handleKeyPress);
      
      // Start with paused preview
      gamePaused = true;
      gameRunning = false;
      showGamePreview();
    }

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight - document.querySelector('.game-header').offsetHeight;
      
      if (ground.y) {
        ground.y = canvas.height - ground.height;
        ground.width = canvas.width;
        if (!polarBear.jumping) {
          polarBear.y = ground.y - polarBear.height;
        }
      }
    }

    function loadQuizData() {
      const urlParams = new URLSearchParams(window.location.search);
      const encodedQuiz = urlParams.get('quiz');
      
      if (encodedQuiz) {
        try {
          const decodedQuiz = atob(encodedQuiz);
          quizData = JSON.parse(decodedQuiz);
          console.log('Quiz loaded:', quizData);
        } catch (error) {
          console.error('Error loading quiz:', error);
          useDefaultQuestions();
        }
      } else {
        useDefaultQuestions();
      }
    }

    function useDefaultQuestions() {
      quizData = {
        title: "Polar Quiz",
        questions: [
          {
            question: "What is the largest type of bear?",
            answers: ["Polar Bear", "Grizzly Bear", "Black Bear", "Panda Bear"],
            correct: 0
          },
          {
            question: "Where do polar bears primarily live?",
            answers: ["Antarctica", "Arctic", "Alaska", "Canada"],
            correct: 1
          },
          {
            question: "What do polar bears mainly eat?",
            answers: ["Fish", "Seals", "Berries", "Honey"],
            correct: 1
          }
        ]
      };
    }

    function startGame() {
      document.getElementById('startScreen').classList.add('hidden');
      showTapToStart();
    }

    function showGamePreview() {
      // Generate some preview obstacles
      obstacles = [];
      for (let i = 0; i < 3; i++) {
        obstacles.push({
          x: canvas.width + (i * 400) + 200,
          y: ground.y - (25 + Math.random() * 15),
          width: 20 + Math.random() * 15,
          height: 25 + Math.random() * 15,
          type: Math.random() > 0.7 ? 'group' : 'single'
        });
      }
      drawPreview();
    }

    function drawPreview() {
      draw();
      if (!gameRunning) {
        requestAnimationFrame(drawPreview);
      }
    }

    function showTapToStart() {
      document.getElementById('tapToStart').classList.remove('hidden');
      gamePaused = true;
      gameRunning = false;
      showGamePreview();
    }

    function hideTapToStart() {
      document.getElementById('tapToStart').classList.add('hidden');
      gamePaused = false;
      gameRunning = true;
    }

    function actuallyStartGame() {
      hideTapToStart();
      
      // Only reset on first start
      if (score === 0 && questionsAnswered === 0) {
        gameSpeed = 3;
        obstacles = [];
        currentQuestionIndex = 0;
        usedQuestionIndices = [];
        polarBear.animFrame = 0;
        lastCorrectAnswer = false;
      }
      
      polarBear.y = ground.y - polarBear.height;
      polarBear.jumping = false;
      polarBear.grounded = true;
      polarBear.jumpForce = 0;
      
      updateScore();
      gameLoop();
    }

    function handleCanvasClick(e) {
      e.preventDefault();
      if (gamePaused && !gameRunning) {
        actuallyStartGame();
      } else if (gameRunning) {
        jump();
      }
    }

    function handleCanvasTouch(e) {
      e.preventDefault();
      if (gamePaused && !gameRunning) {
        actuallyStartGame();
      } else if (gameRunning) {
        jump();
      }
    }

    function handleKeyPress(event) {
      if (event.code === 'Space' || event.code === 'ArrowUp') {
        event.preventDefault();
        if (gamePaused && !gameRunning) {
          actuallyStartGame();
        } else if (gameRunning) {
          jump();
        }
      }
    }

    function gameLoop() {
      if (!gameRunning || gamePaused) return;
      
      update();
      draw();
      requestAnimationFrame(gameLoop);
    }

    function update() {
      polarBear.animFrame += 0.2;
      
      if (polarBear.jumping) {
        polarBear.y += polarBear.jumpForce;
        polarBear.jumpForce += gravity;
        
        if (polarBear.y >= ground.y - polarBear.height) {
          polarBear.y = ground.y - polarBear.height;
          polarBear.jumping = false;
          polarBear.grounded = true;
          polarBear.jumpForce = 0;
        }
      }
      
      // Generate obstacles with better spacing and variety
      if (obstacles.length === 0 || obstacles[obstacles.length - 1].x < canvas.width - (400 + Math.random() * 300)) {
        const obstacleType = Math.random();
        const baseY = ground.y - 25;
        
        if (obstacleType > 0.7) {
          // Create grouped icebergs
          const groupX = canvas.width;
          for (let i = 0; i < 2 + Math.floor(Math.random() * 2); i++) {
            obstacles.push({
              x: groupX + (i * 30),
              y: baseY - Math.random() * 10,
              width: 15 + Math.random() * 10,
              height: 20 + Math.random() * 15,
              type: 'group'
            });
          }
        } else {
          // Single iceberg
          obstacles.push({
            x: canvas.width,
            y: baseY - Math.random() * 15,
            width: 20 + Math.random() * 20,
            height: 25 + Math.random() * 20,
            type: 'single'
          });
        }
      }
      
      for (let i = obstacles.length - 1; i >= 0; i--) {
        obstacles[i].x -= gameSpeed;
        
        if (obstacles[i].x + obstacles[i].width < 0) {
          obstacles.splice(i, 1);
          score += 10;
          updateScore();
        }
      }
      
      snowflakes.forEach(flake => {
        flake.y += flake.speed;
        flake.x += Math.sin(flake.y * 0.01) * 0.5;
        
        if (flake.y > canvas.height) {
          flake.y = -10;
          flake.x = Math.random() * canvas.width;
        }
      });
      
      for (let obstacle of obstacles) {
        if (polarBear.x + 8 < obstacle.x + obstacle.width &&
            polarBear.x + polarBear.width - 8 > obstacle.x &&
            polarBear.y + 8 < obstacle.y + obstacle.height &&
            polarBear.y + polarBear.height - 5 > obstacle.y) {
          gameOver();
          break;
        }
      }
      
      // Gradually increase speed
      gameSpeed += 0.001;
    }

    function draw() {
      const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
      gradient.addColorStop(0, '#E3F2FD');
      gradient.addColorStop(1, '#FFFFFF');
      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      // Draw snowflakes
      ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
      snowflakes.forEach(flake => {
        ctx.beginPath();
        ctx.arc(flake.x, flake.y, flake.size, 0, Math.PI * 2);
        ctx.fill();
      });
      
      // Draw ground with ice texture
      ctx.fillStyle = '#E8F4FD';
      ctx.fillRect(0, ground.y, ground.width, ground.height);
      
      // Ice surface details
      ctx.fillStyle = '#B3E5FC';
      const icePattern = Math.floor((-score / 3) % 80);
      for (let i = icePattern; i < canvas.width; i += 80) {
        ctx.fillRect(i, ground.y + 5, 40, 8);
        ctx.fillRect(i + 20, ground.y + 15, 25, 6);
      }
      
      drawPolarBear();
      obstacles.forEach(obstacle => drawIceberg(obstacle));
    }

    function drawPolarBear() {
      const x = polarBear.x;
      const y = polarBear.y;
      
      if (playerSprite && playerSprite.complete) {
        // Draw sprite
        ctx.drawImage(playerSprite, x, y, polarBear.width, polarBear.height);
      } else {
        // Fallback drawing - improved version
        const bounce = Math.sin(polarBear.animFrame) * 2;
        
        ctx.fillStyle = '#FFFFFF';
        ctx.strokeStyle = '#1565C0';
        ctx.lineWidth = 2;
        
        // Body
        ctx.beginPath();
        ctx.ellipse(x + 20, y + 25 + bounce, 18, 12, 0, 0, Math.PI * 2);
        ctx.fill();
        ctx.stroke();
        
        // Head
        ctx.beginPath();
        ctx.arc(x + 20, y + 12 + bounce, 12, 0, Math.PI * 2);
        ctx.fill();
        ctx.stroke();
        
        // Ears
        ctx.beginPath();
        ctx.arc(x + 14, y + 6 + bounce, 4, 0, Math.PI * 2);
        ctx.fill();
        ctx.stroke();
        
        ctx.beginPath();
        ctx.arc(x + 26, y + 6 + bounce, 4, 0, Math.PI * 2);
        ctx.fill();
        ctx.stroke();
        
        // Eyes
        ctx.fillStyle = '#1A1A1A';
        ctx.beginPath();
        ctx.arc(x + 17, y + 10 + bounce, 2, 0, Math.PI * 2);
        ctx.fill();
        
        ctx.beginPath();
        ctx.arc(x + 23, y + 10 + bounce, 2, 0, Math.PI * 2);
        ctx.fill();
        
        // Nose
        ctx.beginPath();
        ctx.ellipse(x + 20, y + 14 + bounce, 2, 1.5, 0, 0, Math.PI * 2);
        ctx.fill();
      }
    }

    function drawIceberg(obstacle) {
      const x = obstacle.x;
      const y = obstacle.y;
      const w = obstacle.width;
      const h = obstacle.height;
      
      // Enhanced iceberg with more detail
      const gradient = ctx.createLinearGradient(x, y, x + w, y + h);
      gradient.addColorStop(0, '#F0F8FF');
      gradient.addColorStop(0.5, '#E1F5FE');
      gradient.addColorStop(1, '#B3E5FC');
      
      ctx.fillStyle = gradient;
      ctx.strokeStyle = obstacle.type === 'group' ? '#0288D1' : '#0277BD';
      ctx.lineWidth = 2;
      
      ctx.beginPath();
      ctx.moveTo(x, y + h);
      ctx.lineTo(x + w * 0.15, y + h * 0.1);
      ctx.lineTo(x + w * 0.35, y);
      ctx.lineTo(x + w * 0.65, y + h * 0.05);
      ctx.lineTo(x + w * 0.85, y + h * 0.15);
      ctx.lineTo(x + w, y + h);
      ctx.closePath();
      ctx.fill();
      ctx.stroke();
      
      // Ice cracks/details
      ctx.strokeStyle = 'rgba(2, 119, 189, 0.3)';
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.moveTo(x + w * 0.2, y + h * 0.3);
      ctx.lineTo(x + w * 0.8, y + h * 0.7);
      ctx.moveTo(x + w * 0.6, y + h * 0.2);
      ctx.lineTo(x + w * 0.4, y + h * 0.9);
      ctx.stroke();
    }

    function jump() {
      if (polarBear.grounded && !polarBear.jumping) {
        polarBear.jumping = true;
        polarBear.grounded = false;
        polarBear.jumpForce = -13;
      }
    }

    function gameOver() {
      gameRunning = false;
      
      if (score > highScore) {
        highScore = score;
        localStorage.setItem('polorBearHighScore', highScore);
        document.getElementById('highScore').textContent = highScore;
      }
      
      showQuizModal();
    }

    function getNextQuestion() {
      if (!quizData || !quizData.questions || quizData.questions.length === 0) {
        return null;
      }
      
      // If we've used all questions, reset the used list
      if (usedQuestionIndices.length >= quizData.questions.length) {
        usedQuestionIndices = [];
      }
      
      // Find an unused question
      let questionIndex;
      do {
        questionIndex = Math.floor(Math.random() * quizData.questions.length);
      } while (usedQuestionIndices.includes(questionIndex));
      
      usedQuestionIndices.push(questionIndex);
      currentQuestionIndex = questionIndex;
      
      return quizData.questions[questionIndex];
    }

    function showQuizModal() {
      const question = getNextQuestion();
      
      if (!question) {
        showGameOverScreen();
        return;
      }
      
      document.getElementById('questionText').textContent = question.question;
      
      // Load question image
      const imagePrompt = `${question.question} ${question.answers[0]}`;
      const imageUrl = `https://image.pollinations.ai/prompt/${encodeURIComponent(imagePrompt)}?width=400&height=200&nologo=true`;
      const imageElement = document.getElementById('questionImage');
      
      imageElement.src = imageUrl;
      imageElement.style.display = 'block';
      imageElement.style.opacity = '0.5';
      
      imageElement.onload = () => {
        imageElement.style.opacity = '1';
      };
      
      imageElement.onerror = () => {
        imageElement.style.display = 'none';
      };
      
      const answersGrid = document.getElementById('answersGrid');
      answersGrid.innerHTML = '';
      
      question.answers.forEach((answer, index) => {
        const btn = document.createElement('button');
        btn.className = 'answer-btn';
        btn.textContent = answer;
        btn.onclick = () => selectAnswer(index, question.correct, question.answers);
        answersGrid.appendChild(btn);
      });
      
      document.getElementById('quizResult').classList.add('hidden');
      document.getElementById('continueBtn').classList.add('hidden');
      document.getElementById('continueBtn').disabled = true;
      lastCorrectAnswer = false;
      document.getElementById('quizModal').classList.remove('hidden');
    }

    function selectAnswer(selectedIndex, correctIndex, answers) {
      const buttons = document.querySelectorAll('.answer-btn');
      const resultDiv = document.getElementById('quizResult');
      const continueBtn = document.getElementById('continueBtn');
      
      buttons.forEach(btn => btn.style.pointerEvents = 'none');
      
      buttons[correctIndex].classList.add('correct');
      if (selectedIndex !== correctIndex) {
        buttons[selectedIndex].classList.add('incorrect');
      }
      
      const isCorrect = selectedIndex === correctIndex;
      lastCorrectAnswer = isCorrect;
      
      if (isCorrect) {
        resultDiv.textContent = 'üéâ Correct! You can continue running!';
        resultDiv.className = 'quiz-result correct';
        resultDiv.classList.remove('hidden');
        
        score += 50;
        updateScore();
        continueBtn.disabled = false;
        continueBtn.textContent = 'Continue Running';
        continueBtn.classList.remove('hidden');
        
        questionsAnswered++;
        updateScore();
      } else {
        resultDiv.textContent = `‚ùå Incorrect! The correct answer was: ${answers[correctIndex]}`;
        resultDiv.className = 'quiz-result incorrect';
        resultDiv.classList.remove('hidden');
        
        continueBtn.disabled = false;
        continueBtn.textContent = 'Try Next Question';
        
        // Show continue button after 3 seconds
        setTimeout(() => {
          continueBtn.classList.remove('hidden');
        }, 3000);
        
        questionsAnswered++;
        updateScore();
      }
    }

    function continueGame() {
      document.getElementById('quizModal').classList.add('hidden');
      
      // Reset bear position
      polarBear.y = ground.y - polarBear.height;
      polarBear.jumping = false;
      polarBear.grounded = true;
      polarBear.jumpForce = 0;
      
      // Clear nearby obstacles
      obstacles = obstacles.filter(obstacle => obstacle.x > polarBear.x + 150);
      
      showTapToStart();
    }

    function showGameOverScreen() {
      document.getElementById('finalScore').textContent = `Final Score: ${score}`;
      document.getElementById('highScoreDisplay').textContent = `High Score: ${highScore}`;
      document.getElementById('gameOverScreen').classList.remove('hidden');
    }

    function restartGame() {
      document.getElementById('gameOverScreen').classList.add('hidden');
      document.getElementById('quizModal').classList.add('hidden');
      
      // Reset everything
      score = 0;
      questionsAnswered = 0;
      gameSpeed = 3;
      obstacles = [];
      usedQuestionIndices = [];
      lastCorrectAnswer = false;
      
      updateScore();
      showTapToStart();
    }

    function updateScore() {
      document.getElementById('currentScore').textContent = score;
      document.getElementById('questionsAnswered').textContent = questionsAnswered;
    }

    window.addEventListener('load', initGame);
  </script>
</body>
</html>
