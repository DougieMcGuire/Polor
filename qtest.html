<!DOCTYPE html>
<html>
<head>
  <title>Google Form JSON Importer</title>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 2rem; }
    input { width: 500px; padding: 0.5rem; font-size: 1rem; }
    button { padding: 0.5rem 1rem; font-size: 1rem; margin-left: 0.5rem; }
    pre { background: #f0f0f0; padding: 1rem; max-height: 500px; overflow: auto; white-space: pre-wrap; }
  </style>
</head>
<body>
  <h1>Google Form JSON Importer</h1>
  <input type="text" id="formUrl" placeholder="Paste Google Form URL (viewform link)" />
  <button onclick="authorize()">Sign In & Fetch Form</button>
  <pre id="output">Paste a Google Form URL and click the button.</pre>

  <script>
    const CLIENT_ID = "232986823513-c8rsg486ajmis1stpci6r8ui55dah4t2.apps.googleusercontent.com"; // Replace with yours
    const SCOPES = "https://www.googleapis.com/auth/forms.body.readonly";

    let tokenClient;
    let accessToken = "";

    function authorize() {
      tokenClient = google.accounts.oauth2.initTokenClient({
        client_id: CLIENT_ID,
        scope: SCOPES,
        callback: async (tokenResponse) => {
          if (tokenResponse.error) {
            document.getElementById('output').textContent = '‚ùå Auth error: ' + tokenResponse.error;
            return;
          }
          accessToken = tokenResponse.access_token;
          const url = document.getElementById('formUrl').value.trim();
          const formId = extractFormId(url);
          if (!formId) {
            document.getElementById('output').textContent = "‚ùå Invalid Google Form URL.";
            return;
          }
          await fetchFormJSON(formId);
        }
      });
      tokenClient.requestAccessToken();
    }

    function extractFormId(url) {
      // Supports responder links like /viewform
      const eMatch = url.match(/\/forms\/d\/e\/([a-zA-Z0-9_-]+)/);
      const regularMatch = url.match(/\/forms\/d\/([a-zA-Z0-9_-]+)/);
      return (eMatch && eMatch[1]) || (regularMatch && regularMatch[1]) || null;
    }

    async function fetchFormJSON(formId) {
      document.getElementById('output').textContent = "üì• Fetching form JSON...";
      try {
        const response = await fetch(`https://forms.googleapis.com/v1/forms/${formId}`, {
          headers: { Authorization: `Bearer ${accessToken}` }
        });
        if (!response.ok) {
          const errorText = await response.text();
          document.getElementById('output').textContent = "‚ùå Error fetching form:\n" + errorText;
          return;
        }
        const data = await response.json();
        document.getElementById('output').textContent = JSON.stringify(data, null, 2);
      } catch (err) {
        document.getElementById('output').textContent = "‚ùå Fetch error: " + err.message;
      }
    }
  </script>
</body>
</html>
